<!--
Copyright (c) 2022, 2023 Bayerische Motoren Werke Aktiengesellschaft (BMW AG)
Copyright (c) 2022, 2023 ZF Friedrichshafen AG
Copyright (c) 2022, 2023 Contributors to the Eclipse Foundation

See the NOTICE file(s) distributed with this work for additional
information regarding copyright ownership.

This program and the accompanying materials are made available under the
terms of the Apache License, Version 2.0 which is available at
https://www.apache.org/licenses/LICENSE-2.0.

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.

SPDX-License-Identifier: Apache-2.0
-->

<mat-card>
  <mat-card-header>
    <div class="inline-block w-full">
      <div class="flex justify-between items-center">
        <h3 class="flex items-center">
          <img class="pr-2" src="/assets/images/icons/my_parts_icon_header.svg" alt="My parts icon" />
          {{ 'pageTitle.parts' | i18n }}
        </h3>
      </div>
    </div>
    <div [formGroup]="searchFormGroup">
      <app-input color="accent" [label]="'parts.input.global-search.placeholder' | i18n" [prefixIconHover]="true"
        (prefixIconClick)="triggerPartSearch()" [onEnterActive]="true" [prefixIcon]="'search'"
        formControlName="partSearch" [parentFormGroup]="searchFormGroup" [parentControlName]="'partSearch'"
        [displayClearButton]="true" prefixIconColor="accent"></app-input>
    </div>
  </mat-card-header>
  <mat-card-content>
    <div class="parts-table-container">
      <div class="app-bom-lifecycle-activator-container">
        <app-bom-lifecycle-activator [view]=UserSettingView.PARTS
          (buttonClickEvent)="handleTableActivationEvent($event)"></app-bom-lifecycle-activator>
      </div>
      <div class="split-container-wrapper">
        <as-split direction="horizontal">
          <as-split-area *ngIf="bomLifecycleSize?.asBuiltSize > 0" data-testid="as-split-area-1-component--test-id"
            [size]="bomLifecycleSize.asBuiltSize" class="split-area">
            <div class="parts-table-wrapper">
              <ng-container
                *viewContainer="partsAsBuilt$ | async; main: mainTmp; error: errorTmp; loading: loaderTmp"></ng-container>
              <ng-template #mainTmp let-parts="view">
                <!-- asBuilt Parts Table-->
                <app-parts-table [tableHeader]="'page.asBuiltParts' | i18n" [showAlertButton]="true"
                  [paginationData]="parts.data | formatPaginationSemanticDataModelToCamelCase" [labelId]="titleId"
                  [multiSelectActive]="true" [selectedPartsActionLabel]="'page.selectedParts.action'"
                  [deselectTrigger]="deselectPartTrigger$ | async" [addTrigger]="addPartTrigger$ | async"
                  (selected)="onSelectItem($event)" (configChanged)="onAsBuiltTableConfigChange($event)"
                  (multiSelect)="currentSelectedItems$.next($event)" (clickSelectAction)="isAlertOpen$.next(true)"
                  (filterActivated)="filterActivated(true, $event )" [multiSortList]="tableAsBuiltSortList"
                  [tableType]="PartTableType.AS_BUILT_OWN"></app-parts-table>
              </ng-template>
            </div>
          </as-split-area>

          <as-split-area *ngIf="bomLifecycleSize?.asPlannedSize > 0" data-testid="as-split-area-2-component--test-id"
            [size]="bomLifecycleSize.asPlannedSize" class="split-area">
            <div class="parts-table-wrapper">
              <ng-container
                *viewContainer="partsAsPlanned$ | async; main: myTmp; error: errorTmp; loading: loaderTmp"></ng-container>
              <ng-template #myTmp let-parts="view">
                <!-- asPlanned Parts Table-->
                <app-parts-table [tableHeader]="'page.asPlannedParts' | i18n"
                  [paginationData]="parts.data | formatPaginationSemanticDataModelToCamelCase" [labelId]="titleId"
                  [multiSelectActive]="true" [selectedPartsActionLabel]="'page.selectedParts.action'"
                  [deselectTrigger]="deselectPartTrigger$ | async" [addTrigger]="addPartTrigger$ | async"
                  (selected)="onSelectItem($event)" (configChanged)="onAsPlannedTableConfigChange($event)"
                  (multiSelect)="currentSelectedItems$.next($event)" (clickSelectAction)="isAlertOpen$.next(true)"
                  (filterActivated)="filterActivated(false, $event)" [multiSortList]="tableAsPlannedSortList"
                  [tableType]="PartTableType.AS_PLANNED_OWN"></app-parts-table>
              </ng-template>
            </div>
          </as-split-area>

          <as-split-area *ngIf="bomLifecycleSize?.asDesignedSize > 0" data-testid="as-split-area-2-component--test-id"
            [size]="bomLifecycleSize.asDesignedSize" class="split-area">
            <div class="parts-table-wrapper">
              <ng-container
                *viewContainer="partsAsDesigned$ | async; main: myTmp; error: errorTmp; loading: loaderTmp"></ng-container>
              <ng-template #myTmp let-parts="view">
                <!-- asDesigned Parts Table-->
                <app-parts-table [tableHeader]="'page.asDesignedParts' | i18n"
                  [paginationData]="parts.data | formatPaginationSemanticDataModelToCamelCase" [labelId]="titleId"
                  [multiSelectActive]="true" [selectedPartsActionLabel]="'page.selectedParts.action'"
                  [deselectTrigger]="deselectPartTrigger$ | async" [addTrigger]="addPartTrigger$ | async"
                  (selected)="onSelectItem($event)" (configChanged)="onAsDesignedTableConfigChange($event)"
                  (multiSelect)="currentSelectedItems$.next($event)" (clickSelectAction)="isAlertOpen$.next(true)"
                  (filterActivated)="filterActivated(false, $event)" [multiSortList]="tableAsDesignedSortList"
                  [tableType]="PartTableType.AS_DESIGNED_OWN"></app-parts-table>
              </ng-template>
            </div>
          </as-split-area>

          <as-split-area *ngIf="bomLifecycleSize?.asOrderedSize > 0" data-testid="as-split-area-2-component--test-id"
            [size]="bomLifecycleSize.asOrderedSize" class="split-area">
            <div class="parts-table-wrapper">
              <ng-container
                *viewContainer="partsAsOrdered$ | async; main: myTmp; error: errorTmp; loading: loaderTmp"></ng-container>
              <ng-template #myTmp let-parts="view">
                <!-- asOrded Parts Table-->
                <app-parts-table [tableHeader]="'page.asOrderedParts' | i18n"
                  [paginationData]="parts.data | formatPaginationSemanticDataModelToCamelCase" [labelId]="titleId"
                  [multiSelectActive]="true" [selectedPartsActionLabel]="'page.selectedParts.action'"
                  [deselectTrigger]="deselectPartTrigger$ | async" [addTrigger]="addPartTrigger$ | async"
                  (selected)="onSelectItem($event)" (configChanged)="onAsOrderedTableConfigChange($event)"
                  (multiSelect)="currentSelectedItems$.next($event)" (clickSelectAction)="isAlertOpen$.next(true)"
                  (filterActivated)="filterActivated(false, $event)" [multiSortList]="tableAsOrderedSortList"
                  [tableType]="PartTableType.AS_ORDERED_OWN"></app-parts-table>
              </ng-template>
            </div>
          </as-split-area>

          <as-split-area *ngIf="bomLifecycleSize?.asSupportedSize > 0" data-testid="as-split-area-2-component--test-id"
            [size]="bomLifecycleSize.asOrderedSize" class="split-area">
            <div class="parts-table-wrapper">
              <ng-container
                *viewContainer="partsAsSupported$ | async; main: myTmp; error: errorTmp; loading: loaderTmp"></ng-container>
              <ng-template #myTmp let-parts="view">
                <!-- asSupported Parts Table-->
                <app-parts-table [tableHeader]="'page.asSupportedParts' | i18n"
                  [paginationData]="parts.data | formatPaginationSemanticDataModelToCamelCase" [labelId]="titleId"
                  [multiSelectActive]="true" [selectedPartsActionLabel]="'page.selectedParts.action'"
                  [deselectTrigger]="deselectPartTrigger$ | async" [addTrigger]="addPartTrigger$ | async"
                  (selected)="onSelectItem($event)" (configChanged)="onAsSupportedTableConfigChange($event)"
                  (multiSelect)="currentSelectedItems$.next($event)" (clickSelectAction)="isAlertOpen$.next(true)"
                  (filterActivated)="filterActivated(false, $event)" [multiSortList]="tableAsSupportedSortList"
                  [tableType]="PartTableType.AS_SUPPORTED_OWN"></app-parts-table>
              </ng-template>
            </div>
          </as-split-area>

          <as-split-area *ngIf="bomLifecycleSize?.asRecycledSize > 0" data-testid="as-split-area-2-component--test-id"
            [size]="bomLifecycleSize.asRecycledSize" class="split-area">
            <div class="parts-table-wrapper">
              <ng-container
                *viewContainer="partsAsRecycled$ | async; main: myTmp; error: errorTmp; loading: loaderTmp"></ng-container>
              <ng-template #myTmp let-parts="view">
                <!-- asRecycled Parts Table-->
                <app-parts-table [tableHeader]="'page.asRecycledParts' | i18n"
                  [paginationData]="parts.data | formatPaginationSemanticDataModelToCamelCase" [labelId]="titleId"
                  [multiSelectActive]="true" [selectedPartsActionLabel]="'page.selectedParts.action'"
                  [deselectTrigger]="deselectPartTrigger$ | async" [addTrigger]="addPartTrigger$ | async"
                  (selected)="onSelectItem($event)" (configChanged)="onAsRecycledTableConfigChange($event)"
                  (multiSelect)="currentSelectedItems$.next($event)" (clickSelectAction)="isAlertOpen$.next(true)"
                  (filterActivated)="filterActivated(false, $event)" [multiSortList]="tableAsRecycledSortList"
                  [tableType]="PartTableType.AS_RECYCLED_OWN"></app-parts-table>
              </ng-template>
            </div>
          </as-split-area>
        </as-split>
      </div>

      <app-part-detail></app-part-detail>

      <app-sidenav-wrapper [isOpen]="isAlertOpen$ | async" (sidenavAction)="isAlertOpen$.next($event)">
        <app-request-alert *ngIf="isAlertOpen$ | async" [selectedItems]="currentSelectedItems$ | async"
          (deselectPart)="deselectPartTrigger$.next([$event])" (restorePart)="addPartTrigger$.next($event)"
          (clearSelected)="deselectPartTrigger$.next(currentSelectedItems$.value)"
          (submitted)="isAlertOpen$.next(false)"></app-request-alert>
      </app-sidenav-wrapper>

      <ng-template #errorTmp let-parts="view">
        <h1>{{ 'dataLoading.error' | i18n }}</h1>
        <p>{{ parts.error }}</p>
      </ng-template>

      <ng-template #loaderTmp let-parts="view">
        <mat-spinner></mat-spinner>
      </ng-template>
    </div>
  </mat-card-content>
</mat-card>